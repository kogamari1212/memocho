var kntxtext={config:{labelStr:{hira:"ふりがなを自動挿入する",kana:"フリガナを自動挿入する"},btnStr:{hira:"名前からふりがなを挿入する",kana:"名前からフリガナを挿入する"},cls:{checkbox:"",button:"",label:"",div:""},styles:{checkbox:"border:none; background:transparent; cursor:pointer; margin-left:5px;",button:"margin:0 0 0 5px;",label:"cursor:pointer;",div:"margin:0; padding:0; background:transparent; display:inline;"}},constant:{letterType:{hira:0,kana:1},insertType:{auto:0,check:1,checked:2,button:3}},target:[],sys:{config:{idBaseStr:"kntxtext_",kanaExtractionPattern:new RegExp("[^ 　ぁあ-んー]","g"),kanaCompactingPattern:new RegExp("[ぁぃぅぇぉっゃゅょ]","g")},flags:{convert:!1,active:!0},elements:{name:null,kana:null},storage:{timer:null,baseKana:"",ignoreString:"",values:[],input:""}},initialize:function(){for(var t=0,e=kntxtext.target.length;e>t;t++){{var n=kntxtext.target[t][0],a=kntxtext.target[t][1],s=document.getElementsByName(n);document.getElementsByName(a)}switch(s[0].correspondingInput=kntxtext.target[t][1],s[0].letterType=kntxtext.target[t][2],s[0].insertType=kntxtext.target[t][3],kntxtext.target[t][3]){case kntxtext.constant.insertType.check:kntxtext.createCheckBox(s[0],!1);break;case kntxtext.constant.insertType.checked:kntxtext.createCheckBox(s[0],!0);break;case kntxtext.constant.insertType.button:kntxtext.createButton(s[0])}kntxtext.addEvent(s[0],"focus",kntxtext.focus),kntxtext.addEvent(s[0],"keydown",kntxtext.keydown),kntxtext.addEvent(s[0],"blur",kntxtext.blur)}},focus:function(){kntxtext.sys.elements.name=this,kntxtext.sys.elements.kana=document.getElementsByName(this.correspondingInput)?document.getElementsByName(this.correspondingInput)[0]:null,kntxtext.observe.prepare(),kntxtext.observe.start()},keydown:function(){kntxtext.sys.flags.convert&&kntxtext.observe.prepare()},blur:function(){kntxtext.observe.stop()},observe:{start:function(){kntxtext.sys.storage.timer=window.setInterval(kntxtext.check.value,30)},stop:function(){window.clearInterval(kntxtext.sys.storage.timer)},prepare:function(){var t=kntxtext.sys.elements.name.insertType;switch(t!=kntxtext.constant.insertType.button&&(kntxtext.sys.storage.baseKana=kntxtext.sys.elements.kana.value),kntxtext.sys.flags.convert=!1,kntxtext.sys.storage.ignoreString=kntxtext.sys.elements.name.value,t){case kntxtext.constant.insertType.check:case kntxtext.constant.insertType.checked:var e=document.getElementById(new String(kntxtext.sys.config.idBaseStr+kntxtext.sys.elements.name.name));kntxtext.sys.flags.active=e&&e.checked?!0:!1;break;case kntxtext.constant.insertType.button:kntxtext.sys.flags.active=!1;break;default:kntxtext.sys.flags.active=!0}},set:function(){kntxtext.sys.storage.baseKana=new String(kntxtext.sys.storage.baseKana+kntxtext.sys.storage.values.join("")),kntxtext.sys.flags.convert=!0,kntxtext.sys.storage.values=new Array},clear:function(){kntxtext.sys.storage.baseKana="",kntxtext.sys.flags.convert=!1,kntxtext.sys.storage.ignoreString="",kntxtext.sys.storage.input="",kntxtext.sys.storage.values=[]}},check:{value:function(){var t=kntxtext.sys.elements.name.value;switch(t){case"":kntxtext.observe.clear(),kntxtext.setKanaStr();break;default:switch(t=kntxtext.clean(t)){case kntxtext.sys.storage.input:return;default:if(kntxtext.sys.storage.input=t,!kntxtext.sys.flags.convert){var e=t.replace(kntxtext.sys.config.kanaExtractionPattern,"").split("");kntxtext.check.convert(e),kntxtext.setKanaStr(e)}}}},convert:function(t){if(!kntxtext.sys.flags.convert){var e=kntxtext.sys.storage.values.length-t.length,n=Math.abs(e);switch(!0){case n>1:var a=t.join("").replace(kntxtext.sys.config.kanaCompactingPattern,"").split(""),s=kntxtext.sys.storage.values.length-a.length,x=Math.abs(s);x>1&&kntxtext.observe.set();break;default:kntxtext.sys.storage.values.length==kntxtext.sys.storage.input.length&&kntxtext.sys.storage.values.join("")!=kntxtext.sys.storage.input&&kntxtext.observe.set()}}}},setKanaStr:function(t){if(!kntxtext.sys.flags.convert){t&&(kntxtext.sys.storage.values=t);var e=kntxtext.convert2kana(new String(kntxtext.sys.storage.baseKana+kntxtext.sys.storage.values.join("")));kntxtext.sys.elements.kana.value!=e&&(kntxtext.sys.elements.kana.value=e)}},convert2kana:function(t){var e=kntxtext.sys.elements.name.letterType;switch(e){case kntxtext.constant.letterType.kana:for(var n=new String(""),a=0,s=t.length;s>a;a++){var x=t.charCodeAt(a);switch(kntxtext.isHiragana(x)){case!0:n+=String.fromCharCode(x+96);break;default:n+=t.charAt(a)}}return n;default:return t}},isHiragana:function(t){return t>=12353&&12435>=t||12445==t||12446==t},clean:function(t){if(t.indexOf(kntxtext.sys.storage.ignoreString)>-1)return t.replace(kntxtext.sys.storage.ignoreString,"");for(var e=kntxtext.sys.storage.ignoreString.split(""),n=t.split(""),a=0,s=e.length;s>a;a++)switch(e[a]){case n[a]:n[a]=""}return n.join("")},createCheckBox:function(t,e){var n=t.parentNode,a=kntxtext.createBlock(),s=kntxtext.createInputCheckbox(t,e),x=kntxtext.createLabel(t);n.replaceChild(a,t),a.appendChild(t),a.appendChild(s),s.checked=e,a.appendChild(x)},createBlock:function(){var t=document.createElement("div");return kntxtext.config.cls.div&&(t.className=kntxtext.config.cls.div),kntxtext.config.styles.div&&(t.style.cssText=kntxtext.config.styles.div),t},createInputCheckbox:function(t){var e=document.createElement("input");return e.type="checkbox",e.id=new String(kntxtext.sys.config.idBaseStr+t.name),kntxtext.config.cls.checkbox&&(e.className=kntxtext.config.cls.checkbox),kntxtext.config.styles.checkbox&&(e.style.cssText=kntxtext.config.styles.checkbox),e},createLabel:function(t){var e=document.createElement("label");return e.htmlFor=new String(kntxtext.sys.config.idBaseStr+t.name),kntxtext.config.cls.label&&(e.className=kntxtext.config.cls.label),kntxtext.config.styles.label&&(e.style.cssText=kntxtext.config.styles.label),e.innerHTML=t.letterType?kntxtext.config.labelStr.kana:kntxtext.config.labelStr.hira,e},createButton:function(t){var e=t.parentNode,n=kntxtext.createBlock(),a=kntxtext.createInputButton(t);e.replaceChild(n,t),n.appendChild(t),n.appendChild(a)},createInputButton:function(t){var e=document.createElement("input");return e.type="button",e.id=new String(kntxtext.sys.config.idBaseStr+t.name),kntxtext.config.cls.button&&(e.className=kntxtext.config.cls.button),kntxtext.config.styles.button&&(e.style.cssText=kntxtext.config.styles.button),e.value=t.letterType?kntxtext.config.btnStr.kana:kntxtext.config.btnStr.hira,e.onclick=function(){kntxtext.sys.elements.name&&this.id==kntxtext.sys.config.idBaseStr+kntxtext.sys.elements.name.name&&(kntxtext.sys.elements.kana.value=kntxtext.convert2kana(new String(kntxtext.sys.storage.baseKana+kntxtext.sys.storage.values.join(""))))},e},addEvent:function(t,e,n){try{t.addEventListener(e,n,!1)}catch(a){t.attachEvent(new String("on"+e),function(t){return function(){n.call(t)}}(t))}}};kntxtext.addEvent(window,"load",kntxtext.initialize);